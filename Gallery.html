<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>Gallery</title>
	<meta content="width=device-width, initial-scale=1.0" name="viewport">
	<meta content="" name="keywords">
	<meta content="" name="description">

	<link href="img/favicon.png" rel="icon">
	<link href="img/apple-touch-icon.png" rel="apple-touch-icon">

	<link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">

	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Poppins:300,400,500,700"
		rel="stylesheet">


	<link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">


	<link href="lib/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="lib/animate/animate.min.css" rel="stylesheet">


	<link href="css/gallery.css" rel="stylesheet">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

</head>

<body>

	<script src="js/navbar_bg_white.js"></script>

	<main id="main">
		<section id="portfolio">
			<div class="container wow fadeInUp">
				<div class="section-header">
					<h3 class="section-title"></h3>
				</div>
				<div class="row">

					<div class="col-lg-12">
						<h5><b>Filter by:</b></h5>
						<ul id="portfolio-flters">
							<li data-filter=".filter-card">Artist</li>
							<li data-filter=".filter-web">Medium</li>
						</ul>
					</div>
				</div>

				<div class="row" id="portfolio-wrapper">
				</div>

			</div>
		</section>

	</main>

	<script src="js/footer.js"></script>

	<a href="#" class="back-to-top"><i class="fa fa-chevron-up"></i></a>

	<script src="lib/jquery/jquery.min.js"></script>
	<script src="lib/jquery/jquery-migrate.min.js"></script>
	<script src="lib/bootstrap/js/bootstrap.bundle.min.js"></script>
	<script src="lib/easing/easing.min.js"></script>
	<script src="lib/wow/wow.min.js"></script>
	<script src="lib/waypoints/waypoints.min.js"></script>
	<script src="lib/counterup/counterup.min.js"></script>
	<script src="lib/superfish/hoverIntent.js"></script>
	<script src="lib/superfish/superfish.min.js"></script>
	<script src="contactform/contactform.js"></script>
	<script src="js/main.js"></script>
	<script>
		getProductsFromDatabase();
		$("#portfolio-wrapper").on('click', "img", function () {
			window.location = `product.html?id=${$(this).attr("data-id")}`;

		});
		var slideIndex = 1;
		showDivs(slideIndex);

		function plusDivs(n) {
			showDivs(slideIndex += n);
		}

		function currentDiv(n) {
			showDivs(slideIndex = n);
		}

		function showDivs(n) {
			var i;
			var x = document.getElementsByClassName("mySlides");
			var dots = document.getElementsByClassName("demo");
			if (n > x.length) { slideIndex = 1 }
			if (n < 1) { slideIndex = x.length }
			for (i = 0; i < x.length; i++) {
				x[i].style.display = "none";
			}
			for (i = 0; i < dots.length; i++) {
				dots[i].className = dots[i].className.replace(" w3-white", "");
			}
			x[slideIndex - 1].style.display = "block";
			x[slideIndex - 1].style.visibility = "visible";
			dots[slideIndex - 1].className += " w3-white";
		}

		function getProductsFromDatabase() {
			let params = (new URL(document.location)).searchParams;
			let type = params.get("type");
			if (!type)
				type = "paintings";
			$.get(`${new URLBuilder().api().urlString}/${type}.php`, function (data) {
				console.log(data);
				var productsList = $("#portfolio-wrapper");
				data.forEach(function (product) {
					var firstLine = product.name;
					var secondLine, thirdLine;
					var urlString;
					if (type === "paintings") {
						secondLine = product.artist;
						thirdLine = product.medium;
						urlString = URLBuilder.paintingsThumbnailURL(product.artist);
					} else if (type === "sculptures") {
						secondLine = product.name;
						thirdLine = product.artist;
						urlString = URLBuilder.sculpturesThumbnailURL(product.artist);
					} else if (type === "shawls") {
						secondLine = product.type;
						thirdLine = product.gender;
						urlString = URLBuilder.shawlsThumbnailURL();
					} else if (type === "carpets") {
						secondLine = product.type;
						thirdLine = product.origin;
						urlString = URLBuilder.carpetsThumbnailURL();
					}
					console.log(firstLine);
					console.log(secondLine);
					console.log(thirdLine);
					productsList.append(`
						<div class="col-lg-4 col-md-6 portfolio-item filter-app">

							<img src="${urlString}/${product.thumbnail}" alt="" data-id="${product.id}">

							<div style="text-align: center;">
								<h4>${firstLine.toLowerCase()}</h4>
								<span class="product-second-line">${secondLine.toLowerCase()}</span><br />
								<span class="product-third-line" style="color:gray">${thirdLine.toLowerCase()}</span>
							</div>
						</div>
					`);
				});
			});
		}

		function applySearchFilter(event) {
			console.log("YAY SEARCHED");
			console.log(event.which);
			if (event.which == 13) {
				//pressed enter after entering search query
				let params = (new URL(document.location)).searchParams;
				let type = params.get("type");
				let searchQuery = $("#searchText").val().toLowerCase();
				switch (type) {
					case "paintings":
						//show all 
						$(".portfolio-item").show();

						//filter
						$(".portfolio-item").each(function(index, product){
							let firstLine = product.getElementsByTagName("h4")[0].innerHTML;
							let secondLine = product.getElementsByClassName("product-second-line")[0].innerHTML;
							let thirdLine = product.getElementsByClassName("product-third-line")[0].innerHTML;

							if (firstLine.toLowerCase().search(searchQuery)<0 &&
								secondLine.toLowerCase().search(searchQuery)<0 &&
								thirdLine.toLowerCase().search(searchQuery)<0) {
								$(product).hide("slow");
							}
						});
					break;
				}
			}
		}
		
		$("#mobile-nav #searchText").keyup(applySearchFilter);
		$("#nav-menu-container #searchText").keyup(applySearchFilter);

	</script>
</body>

</html>